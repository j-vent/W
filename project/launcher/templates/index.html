{% load static %}
{% block page_content %}
<!DOCTYPE html>
<html>
  <head>
    <title>Some Warmth</title>

    <style type="text/css">
      /* Set the size of the div element that contains the map */
      #map {
        height: 400px;
        /* The height is 400 pixels */
        width: 100%;
        /* The width is the width of the web page */
      }
    </style>
     <script type="text/javascript">
        // data from views.py
        var google_api_key = "{{google_api_key|safe}}";
        let lat_0 = Number("{{lat_0}}");
        let lon_0 = Number("{{lon_0}}");
      </script>
    <script >
      // Initialize and add the map
      function initMap() {
        // The location of center of YEG
        const centerYEG = { lat: 53.544, lng: -113.491};
        // The map, centered in YEG
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 17,
          center: centerYEG,
        });
        
        // TODO: fill all this data with information from views.py
        console.log("LAT!! ", lat_0)
        const housings = [
        [{ lat: lat_0, lng: lon_0}, "McCauley Lodge"],
        [{ lat: 53.55019, lng: -113.49134}, "Hope Mission"],
        [{ lat: 53.54576, lng: -113.51759 }, "Edwardson Place"],
    ];
        // Create an info window to share between markers.
        const infoWindow = new google.maps.InfoWindow();

        // Create the markers.
        housings.forEach(([position, title], i) => {
        const marker = new google.maps.Marker({
            position,
            map,
            title: `${i + 1}. ${title}`,
            label: `${i + 1}`,
            optimized: false,
        });

        // Add a click listener for each marker, and set up the info window.
        marker.addListener("click", () => {
            infoWindow.close();
            infoWindow.setContent(marker.getTitle());
            infoWindow.open(marker.getMap(), marker);
        });
        });
      }
    </script>

  </head>
  <body>
    <h3>MAP!!</h3>
    <!--The div element for the map -->
    <div id="map"></div>

    <!--div element for location -->
    <div name="location">
	<p>Location</p>
	<button>Get Location</button>
    </div>

    
    <!--script src="https://code.jquery.com/jquery-3.6.0.js"></script-->

    <script>
        // Get user location
	const user_location = document.querySelector("location");
	const btn = document.querySelector("button");
	const name = document.querySelector("p");

	function get_user_location() {
	    if (navigator.geolocation) {
	        navigator.geolocation.getCurrentPosition(show_user_location);
	    } else {
	        name.innerHTML = "Can't get location!!";
	    }
        }
	function show_user_location(position) {
	    name.innerHTML = "Latitude: " + position.coords.latitude + ", Longitude: " + position.coords.longitude;
	}
	
        /*
	function send_location(position) {
        $(."btn").click(function(){
	    $.ajax({
	        url: URL,
		type: "POST",
		data: {
		   "latitude": position.coords.latitude,
		   "longitude": position.coords.longitude
	        },
		success: function(result) {
		    name.innerHTML = result;
                },
	        error: function(error) {
	            name.innerHTML = error;
	        }
	    })
	});
	*/
	
        btn.addEventListener("click", get_user_location);

    </script>

    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAuAwyUS_LqCs0uSfMIewefuSSllj2fD7A&callback=initMap&libraries=&v=weekly"
      async
    ></script>
  </body>
</html>
{% endblock %}
