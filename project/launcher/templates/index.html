{% load static %}
{% block page_content %}
<!DOCTYPE html>
<html>
  <head>
    <title>Some Warmth</title>
    <h2>{{res}}</h2>
    <style type="text/css">
      /* Set the size of the div element that contains the map */
      #map {
        height: 400px;
        /* The height is 400 pixels */
        width: 100%;
        /* The width is the width of the web page */
      }
    </style>
 
     <script type="text/javascript">
        // data from views.py
        // var myDjangoList = (("{{all_shelters |safe}}").replace(/&(l|g|quo)t;/g, function(a,b){
        //     return {
        //         l   : '<',
        //         g   : '>',
        //         quo : '"'
        //     }[b];
        // }));

        // myDjangoList = myDjangoList.replace(/u'/g, '\'')
        // myDjangoList = myDjangoList.replace(/'/g, '\"')

        // myData = JSON.parse( myDjangoList );
        // console.log("my data ", myData)
        
        // console.log("name ", myData[0]['shelter_name'])
        // for(var i = 0; i < myData.length; i++) {
        //     console.log("stuff: ", myData[i]['shelter_name'])
        //     console.log("capstuff: ", myData[i]['capacity'])
        // }
        const housings_test = '{{all_shelters|escapejs}}'
        // housings_test = jQuery.parseJSON(housings_test)
        console.log("housing ", housings_test);
        ///console.log("sheltername ", housings_test[0].shelter_name)
        // housings_test.forEach(([position, title], i) => {

        // })
        // for(var i = 0; i < housings_test.length; i++) {
        //     console.log("housing shit " ,housings_test[i]);
        // }
        // for(house in housings_test){
        //     console.log(house)
        //     console.log("housing sheltername ", house.shelter_name);
        // }
        var google_api_key = "{{google_api_key|safe}}";
        // let lat_0 = Number("{{lat_0}}");
        // let lon_0 = Number("{{lon_0}}");
        // for(house in "{{all_shelters}}"){
            
        // }
    </script>
    <script >
      // Initialize and add the map
      function initMap() {
        // The location of center of YEG
        const centerYEG = { lat: 53.544, lng: -113.491};
        // The map, centered in YEG
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 17,
          center: centerYEG,
        });
        
        // TODO: fill all this data with information from views.py
        // just use the top 3 values from the housing list?
        // console.log("LAT!! ", lat_0)
    //     const housings = [
    //     [{ lat: lat_0, lng: lon_0}, "McCauley Lodge"],
    //     [{ lat: 53.55019, lng: -113.49134}, "Hope Mission"],
    //     [{ lat: 53.54576, lng: -113.51759 }, "Edwardson Place"],
    // ];
        const housings = []
        var myDjangoList = (("{{all_shelters |safe}}").replace(/&(l|g|quo)t;/g, function(a,b){
            return {
                l   : '<',
                g   : '>',
                quo : '"'
            }[b];
        }));

        myDjangoList = myDjangoList.replace(/u'/g, '\'')
        myDjangoList = myDjangoList.replace(/'/g, '\"')

        myData = JSON.parse( myDjangoList );
        
        
        // Create an info window to share between markers.
        const infoWindow = new google.maps.InfoWindow();

        for(var i = 0; i < myData.length; i++) {
            let varList = [];
            varList[0] = { lat:parseFloat(myData[i]['latitude']), lng: parseFloat(myData[i]['longitude'])};
            varList[1] = myData[i]['shelter_name'];
            housings[i] = varList;
        }
        console.log("housings** ");
        console.log(housings);
        // Create the markers.
        housings.forEach(([position, title], i) => {
            const marker = new google.maps.Marker({
                position,
                map,
                title: `${i + 1}. ${title}`,
                label: `${i + 1}`,
                optimized: false,
            });
        
            marker.addListener("click", () => {
                infoWindow.close();
                infoWindow.setContent(marker.getTitle());
                infoWindow.open(marker.getMap(), marker);
             });
        }
        // Add a click listener for each marker, and set up the info window.
        
        );

      }
    </script>
  </head>
  <body>
    <h3>MAP!!</h3>
    <!--The div element for the map -->
    <div id="map"></div>
<h1>Housing Project</h1>

<form action="{%  url  'index'  %}" method="POST">
    {% csrf_token %}
    <input type="checkbox" name="lgbtq2s_friendly" value="1">
        <label for="lgbtq2s_friendly">LGBTQ2S+ friendly</label><br>

    <input type="checkbox" name="wheelchair_accessible" value="1">
        <label for="wheelchair_accessible">Wheelchair Accessible</label><br>

    <input type="checkbox" name="public_transit_accessible" value="1">
        <label for="public_transit_accessible">Public Transit accessible</label><br>

    <input type="checkbox" name="women_only" value="1">
        <label for="women_only">Women Only</label><br>

    <input type="checkbox" name="food_provided" value="1">
        <label for="food_provided">Food provided</label><br>

    <input type="checkbox" name="showers_provided" value="1">
        <label for="showers_provided">Showers provided</label><br>

    <input type="submit" value="Submit">
  </form>

<div class="row">
    {% for house in all_shelters %}
        <h2>{{house.shelter_name}}</h2>
        <h2>{{house.address}}</h2>
        <h2>{{house.capacity}}</h2>
    {% endfor %}
</div>
    
    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAuAwyUS_LqCs0uSfMIewefuSSllj2fD7A&callback=initMap&libraries=&v=weekly"
      async
    ></script>
  </body>
</html>
{% endblock %}